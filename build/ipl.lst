     1                                  ; haribote-ipl
     2                                  ; TAB=4
     3                                  
     4                                  CYLS	EQU		10
     5                                  
     6                                  		ORG		0x7c00			; このプログラムがどこに読み込まれるのか
     7                                  
     8                                  ; 以下は標準的なFAT12フォーマットフロッピーディスクのための記述
     9                                  
    10 00000000 EB4E                    		JMP		entry
    11 00000002 90                      		DB		0x90
    12 00000003 48415249424F5445        		DB		"HARIBOTE"		; ブートセクタの名前を自由に書いてよい（8バイト）
    13 0000000B 0002                    		DW		512				; 1セクタの大きさ（512にしなければいけない）
    14 0000000D 01                      		DB		1				; クラスタの大きさ（1セクタにしなければいけない）
    15 0000000E 0100                    		DW		1				; FATがどこから始まるか（普通は1セクタ目からにする）
    16 00000010 02                      		DB		2				; FATの個数（2にしなければいけない）
    17 00000011 E000                    		DW		224				; ルートディレクトリ領域の大きさ（普通は224エントリにする）
    18 00000013 400B                    		DW		2880			; このドライブの大きさ（2880セクタにしなければいけない）
    19 00000015 F0                      		DB		0xf0			; メディアのタイプ（0xf0にしなければいけない）
    20 00000016 0900                    		DW		9				; FAT領域の長さ（9セクタにしなければいけない）
    21 00000018 1200                    		DW		18				; 1トラックにいくつのセクタがあるか（18にしなければいけない）
    22 0000001A 0200                    		DW		2				; ヘッドの数（2にしなければいけない）
    23 0000001C 00000000                		DD		0				; パーティションを使ってないのでここは必ず0
    24 00000020 400B0000                		DD		2880			; このドライブ大きさをもう一度書く
    25 00000024 000029                  		DB		0,0,0x29		; よくわからないけどこの値にしておくといいらしい
    26 00000027 FFFFFFFF                		DD		0xffffffff		; たぶんボリュームシリアル番号
    27 0000002B 48415249424F54454F-     		DB		"HARIBOTEOS "	; ディスクの名前（11バイト）
    27 00000034 5320               
    28 00000036 4641543132202020        		DB		"FAT12   "		; フォーマットの名前（8バイト）
    29 0000003E <res 00000012>          		RESB	18				; とりあえず18バイトあけておく
    29          ******************       warning: uninitialized space declared in .text section: zeroing
    30                                  
    31                                  ; プログラム本体
    32                                  
    33                                  entry:
    34 00000050 B80000                  		MOV		AX,0			; レジスタ初期化
    35 00000053 8ED0                    		MOV		SS,AX
    36 00000055 BC007C                  		MOV		SP,0x7c00
    37 00000058 8ED8                    		MOV		DS,AX
    38                                  
    39                                  ; ディスクを読む
    40                                  
    41 0000005A B82008                  		MOV		AX,0x0820
    42 0000005D 8EC0                    		MOV		ES,AX
    43 0000005F B500                    		MOV		CH,0			; シリンダ0
    44 00000061 B600                    		MOV		DH,0			; ヘッド0
    45 00000063 B102                    		MOV		CL,2			; セクタ2
    46                                  
    47                                  readloop:
    48 00000065 BE0000                  		MOV		SI,0
    49                                  		
    50                                  retry:
    51 00000068 B402                    		MOV		AH,0x02			; AH=0x02 : ディスク読み込み
    52 0000006A B001                    		MOV		AL,1			; 1セクタ
    53 0000006C BB0000                  		MOV		BX,0
    54 0000006F B200                    		MOV		DL,0x00			; Aドライブ
    55 00000071 CD13                    		INT		0x13			; ディスクBIOS呼び出し
    56 00000073 7333                    		JNC		fin
    57 00000075 83C601                  		ADD		SI,1
    58 00000078 83FE05                  		CMP		SI,5
    59 0000007B 732E                    		JAE		error
    60 0000007D B400                    		MOV		AH,0x00
    61 0000007F B200                    		MOV		DL,0x00
    62 00000081 CD13                    		INT		0x13
    63 00000083 EBE3                    		JMP		retry
    64                                  
    65                                  next:
    66 00000085 8CC0                    		MOV		AX,ES
    67 00000087 83C020                  		ADD		AX,0x0020
    68 0000008A 8EC0                    		MOV		ES,AX
    69 0000008C 80C101                  		ADD		CL,1
    70 0000008F 80F912                  		CMP		CL,18
    71 00000092 76D1                    		JBE		readloop
    72 00000094 B101                    		MOV		CL,1
    73 00000096 80C601                  		ADD		DH,1
    74 00000099 80FE02                  		CMP		DH,2
    75 0000009C 72C7                    		JB		readloop
    76 0000009E B600                    		MOV		DH,0
    77 000000A0 80C501                  		ADD		CH,1
    78 000000A3 80FD0A                  		CMP		CH,CYLS
    79 000000A6 72BD                    		JB		readloop
    80                                  
    81                                  fin:
    82 000000A8 F4                      		HLT						; 何かあるまでCPUを停止させる
    83 000000A9 EBFD                    		JMP		fin				; 無限ループ
    84                                  
    85                                  error:
    86 000000AB BE[C000]                		MOV		SI,msg
    87                                  putloop:
    88 000000AE 8A04                    		MOV		AL,[SI]
    89 000000B0 83C601                  		ADD		SI,1			; SIに1を足す
    90 000000B3 3C00                    		CMP		AL,0
    91 000000B5 74F1                    		JE		fin
    92 000000B7 B40E                    		MOV		AH,0x0e			; 一文字表示ファンクション
    93 000000B9 BB0F00                  		MOV		BX,15			; カラーコード
    94 000000BC CD10                    		INT		0x10			; ビデオBIOS呼び出し
    95 000000BE EBEE                    		JMP		putloop
    96                                  msg:
    97 000000C0 0A0A                    		DB		0x0a, 0x0a		; 改行を2つ
    98 000000C2 6C6F6164206572726F-     		DB		"load error"
    98 000000CB 72                 
    99 000000CC 0A                      		DB		0x0a			; 改行
   100 000000CD 00                      		DB		0
   101                                  
   102 000000CE <res 00000130>          		RESB	0x1fe-($-$$)		; 0x7dfeまでを0x00で埋める命令
   102          ******************       warning: uninitialized space declared in .text section: zeroing
   103                                  
   104 000001FE 55AA                    		DB		0x55, 0xaa
